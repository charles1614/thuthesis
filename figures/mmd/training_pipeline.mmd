%%{init: {'theme':'base', 'themeVariables': {'primaryColor':'#FFFFFF','primaryTextColor':'#000','primaryBorderColor':'#999999','lineColor':'#666','secondaryColor':'#F5F5F5','tertiaryColor':'#FFFFFF','noteBkgColor':'#E3F2FD','noteBorderColor':'#1976D2','noteTextColor':'#000','actorBkg':'#FFFFFF','actorBorder':'#999999','actorTextColor':'#000','actorLineColor':'#666','signalColor':'#666','signalTextColor':'#000','labelBoxBkgColor':'#FFFFFF','labelBoxBorderColor':'#999999','labelTextColor':'#000','loopTextColor':'#000','activationBorderColor':'#1976D2','activationBkgColor':'#E3F2FD','sequenceNumberColor':'#FFF'}}}%%
sequenceDiagram
    participant DL as Data Loader
    participant GS as 4DGS Model
    participant RN as Renderer
    participant VD as Video Diffusion
    participant OP as Optimizer
    
    Note over DL,OP: Training Iteration Loop
    
    DL->>+GS: Load viewpoint & conditions
    GS->>+RN: Current 4DGS parameters
    RN->>RN: Render current view
    RN->>-GS: Return rendered image
    
    alt Training Viewpoint
        GS->>OP: Compute reconstruction loss
        Note right of OP: Ground truth supervision
    else Novel Viewpoint
        RN->>+VD: Current render as guidance
        VD->>VD: Generate pseudo GT
        VD->>-OP: Pseudo GT supervision
        OP->>OP: Compute guidance loss
        Note right of OP: Diffusion prior guidance
    end
    
    OP->>GS: Update Gaussian parameters
    
    alt Densification Phase
        GS->>GS: Adaptive densification
        Note right of GS: Dynamic geometry adjustment
    end
    
    Note over DL,OP: Continue until convergence